<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Modernize Free</title>
    <link rel="shortcut icon" type="image/png" href="{{ asset('back-assets/images/logos/favicon.png') }}"/>
    <link rel="stylesheet" href="{{ asset('back-assets/css/styles.min.css') }}"/>
</head>

<body>
<!--  Body Wrapper -->
<div class="page-wrapper" id="main-wrapper" data-layout="vertical" data-navbarbg="skin6" data-sidebartype="full"
     data-sidebar-position="fixed" data-header-position="fixed">
    <!-- Sidebar Start -->
    <aside class="left-sidebar">
        <!-- Sidebar scroll-->
        <div>
            <div class="brand-logo d-flex align-items-center justify-content-between">
                <a href="./index.html" class="text-nowrap logo-img">
                    <img src="back-assets/images/logos/dark-logo.svg" width="180" alt=""/>
                </a>
                <div class="close-btn d-xl-none d-block sidebartoggler cursor-pointer" id="sidebarCollapse">
                    <i class="ti ti-x fs-8"></i>
                </div>
            </div>
            <!-- Sidebar navigation-->
            <nav class="sidebar-nav scroll-sidebar" data-simplebar="">
                <ul id="sidebarnav">
                    <li class="nav-small-cap">
                        <i class="ti ti-dots nav-small-cap-icon fs-4"></i>
                        <span class="hide-menu">Home</span>
                    </li>
                    <li class="sidebar-item">
                        <a class="sidebar-link" href="dashboard" aria-expanded="false">
                <span>
                  <i class="ti ti-layout-dashboard"></i>
                </span>
                            <span class="hide-menu">Dashboard</span>
                        </a>
                    </li>
                    <li class="nav-small-cap">
                        <i class="ti ti-dots nav-small-cap-icon fs-4"></i>
                        <span class="hide-menu">UI COMPONENTS</span>
                    </li>
                    <li class="sidebar-item">
                        <a class="sidebar-link" href="buttons" aria-expanded="false">
                <span>
                  <i class="ti ti-article"></i>
                </span>
                            <span class="hide-menu">Buttons</span>
                        </a>
                    </li>
                    <li class="sidebar-item">
                        <a class="sidebar-link" href="ui-alerts.html.twig" aria-expanded="false">
                <span>
                  <i class="ti ti-alert-circle"></i>
                </span>
                            <span class="hide-menu">Alerts</span>
                        </a>
                    </li>
                    <li class="sidebar-item">
                        <a class="sidebar-link" href="ui-card.html.twig" aria-expanded="false">
                <span>
                  <i class="ti ti-cards"></i>
                </span>
                            <span class="hide-menu">Card</span>
                        </a>
                    </li>
                    <li class="sidebar-item">
                        <a class="sidebar-link" href="ui-forms.html.twig" aria-expanded="false">
                <span>
                  <i class="ti ti-file-description"></i>
                </span>
                            <span class="hide-menu">Forms</span>
                        </a>
                    </li>
                    <li class="sidebar-item">
                        <a class="sidebar-link" href="ui-typography.html.twig" aria-expanded="false">
                <span>
                  <i class="ti ti-typography"></i>
                </span>
                            <span class="hide-menu">Typography</span>
                        </a>
                    </li>
                    <li class="nav-small-cap">
                        <i class="ti ti-dots nav-small-cap-icon fs-4"></i>
                        <span class="hide-menu">AUTH</span>
                    </li>
                    <li class="sidebar-item">
                        <a class="sidebar-link" href="authentication-login.html.twig" aria-expanded="false">
                <span>
                  <i class="ti ti-login"></i>
                </span>
                            <span class="hide-menu">Login</span>
                        </a>
                    </li>
                    <li class="sidebar-item">
                        <a class="sidebar-link" href="authentication-register.html.twig" aria-expanded="false">
                <span>
                  <i class="ti ti-user-plus"></i>
                </span>
                            <span class="hide-menu">Register</span>
                        </a>
                    </li>
                    <li class="nav-small-cap">
                        <i class="ti ti-dots nav-small-cap-icon fs-4"></i>
                        <span class="hide-menu">EXTRA</span>
                    </li>
                    <li class="sidebar-item">
                        <a class="sidebar-link" href="icons" aria-expanded="false">
                <span>
                  <i class="ti ti-mood-happy"></i>
                </span>
                            <span class="hide-menu">Icons</span>
                        </a>
                    </li>
                    <li class="sidebar-item">
                        <a class="sidebar-link" href="./sample-page.html" aria-expanded="false">
                <span>
                  <i class="ti ti-aperture"></i>
                </span>
                            <span class="hide-menu">Sample Page</span>
                        </a>
                    </li>
                </ul>
                <div class="unlimited-access hide-menu bg-light-primary position-relative mb-7 mt-5 rounded">
                    <div class="d-flex">
                        <div class="unlimited-access-title me-3">
                            <h6 class="fw-semibold fs-4 mb-6 text-dark w-85">Upgrade to pro</h6>
                            <a href="https://adminmart.com/product/modernize-bootstrap-5-admin-template/"
                               target="_blank" class="btn btn-primary fs-2 fw-semibold lh-sm">Buy Pro</a>
                        </div>
                        <div class="unlimited-access-img">
                            <img src="back-assets/images/backgrounds/rocket.png" alt="" class="img-fluid">
                        </div>
                    </div>
                </div>
            </nav>
            <!-- End Sidebar navigation -->
        </div>
        <!-- End Sidebar scroll-->
    </aside>
    <!--  Sidebar End -->
    <!--  Main wrapper -->
    <div class="body-wrapper">
        <!--  Header Start -->
        <header class="app-header">
            <nav class="navbar navbar-expand-lg navbar-light">
                <ul class="navbar-nav">
                    <li class="nav-item d-block d-xl-none">
                        <a class="nav-link sidebartoggler nav-icon-hover" id="headerCollapse"
                           href="javascript:void(0)">
                            <i class="ti ti-menu-2"></i>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link nav-icon-hover" href="javascript:void(0)">
                            <i class="ti ti-bell-ringing"></i>
                            <div class="notification bg-primary rounded-circle"></div>
                        </a>
                    </li>
                </ul>
                <div class="navbar-collapse justify-content-end px-0" id="navbarNav">
                    <ul class="navbar-nav flex-row ms-auto align-items-center justify-content-end">
                        <a href="https://adminmart.com/product/modernize-free-bootstrap-admin-dashboard/"
                           target="_blank" class="btn btn-primary">Download Free</a>
                        <li class="nav-item dropdown">
                            <a class="nav-link nav-icon-hover" href="javascript:void(0)" id="drop2"
                               data-bs-toggle="dropdown"
                               aria-expanded="false">
                                <img src="back-assets/images/profile/user-1.jpg" alt="" width="35" height="35"
                                     class="rounded-circle">
                            </a>
                            <div class="dropdown-menu dropdown-menu-end dropdown-menu-animate-up"
                                 aria-labelledby="drop2">
                                <div class="message-body">
                                    <a href="javascript:void(0)"
                                       class="d-flex align-items-center gap-2 dropdown-item">
                                        <i class="ti ti-user fs-6"></i>
                                        <p class="mb-0 fs-3">My Profile</p>
                                    </a>
                                    <a href="javascript:void(0)"
                                       class="d-flex align-items-center gap-2 dropdown-item">
                                        <i class="ti ti-mail fs-6"></i>
                                        <p class="mb-0 fs-3">My Account</p>
                                    </a>
                                    <a href="javascript:void(0)"
                                       class="d-flex align-items-center gap-2 dropdown-item">
                                        <i class="ti ti-list-check fs-6"></i>
                                        <p class="mb-0 fs-3">My Task</p>
                                    </a>
                                    <a href="authentication-login.html.twig"
                                       class="btn btn-outline-primary mx-3 mt-2 d-block">Logout</a>
                                </div>
                            </div>
                        </li>
                    </ul>
                </div>
            </nav>
        </header>
        <!--  Header End -->
        {% block content %}
            <div class="container-fluid">
                <div class="card">
                    <div class="card-body">
                        <h1>User index</h1>

                        <label for="searchInput" class="badge bg-primary rounded-3 fw-semibold"
                               style="margin-right: 4px">Recherche :</label>
                        <input type="text" id="searchInput" placeholder="Entrez le terme...">
                        <select id="searchCategory">
                            <option value="1">ID</option>
                            <option value="2">Email</option>
                            <option value="4">First Name</option>
                            <option value="5">Last Name</option>
                        </select>
                        <button id="searchButton" class="btn btn-success m-1">Rechercher</button>
                        <button id="clearButton" class="btn btn-warning m-1">Effacer</button>
                        <button id="download-btn-users">Download PNG</button>

                        <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/0.4.1/html2canvas.min.js"></script>
                        <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>

                        <table class="table">
                            <thead>
                            <tr>
                                <th><a href="#" class="sort" data-column="1">Id</a></th>
                                <th><a href="#" class="sort" data-column="2">Email</a></th>
                                <th><a href="#" class="sort" data-column="3">Roles</a></th>
                                <th><a href="#" class="sort" data-column="4">Firstname</a></th>
                                <th><a href="#" class="sort" data-column="5">Lastname</a></th>
                                <th><a href="#" class="sort" data-column="6">Address</a></th>
                                <th><a href="#" class="sort" data-column="7">Date_of_birth</a></th>
                                <th>actions</th>
                            </tr>
                            </thead>
                            <tbody>
                            {% for user in users %}
                                <tr>
                                    <td>{{ user.id }}</td>
                                    <td>{{ user.email }}</td>
                                    <td>{{ user.roles ? user.roles|json_encode : '' }}</td>
                                    <td>{{ user.firstname }}</td>
                                    <td>{{ user.lastname }}</td>
                                    <td>{{ user.address }}</td>
                                    <td>{{ user.dateOfBirth ? user.dateOfBirth|date('Y-m-d') : '' }}</td>
                                    <td>
                                        <a href="{{ path('app_user_show', {'id': user.id}) }}">show</a>
                                        <a href="{{ path('app_user_edit', {'id': user.id}) }}">edit</a>
                                        <a href="{{ path('app_user_delete', {'id': user.id}) }}">delete</a>
                                    </td>
                                </tr>
                            {% else %}
                                <tr>
                                    <td colspan="8">no records found</td>
                                </tr>
                            {% endfor %}
                            </tbody>
                        </table>

                        <script>
                            document.addEventListener("DOMContentLoaded", function () {
                                const headers = document.querySelectorAll(".sort");
                                headers.forEach(header => {
                                    header.addEventListener("click", () => {
                                        const column = parseInt(header.dataset.column);
                                        const order = header.dataset.order || "asc";
                                        const direction = order === "desc" ? "asc" : "desc";

                                        // Remove 'sorted' class from all other headers
                                        headers.forEach(h => h.classList.remove("sorted"));

                                        // Update data attributes
                                        header.dataset.order = direction;
                                        header.classList.add("sorted");

                                        // Sort the table
                                        sortTable(column, direction);
                                    });
                                });

                                const searchInput = document.getElementById("searchInput");
                                const searchCategory = document.getElementById("searchCategory");
                                const searchButton = document.getElementById("searchButton");
                                const clearButton = document.getElementById("clearButton");

                                searchButton.addEventListener("click", () => {
                                    searchTable();
                                });

                                clearButton.addEventListener("click", () => {
                                    searchInput.value = "";
                                    searchTable();
                                });

                                function searchTable() {
                                    const searchTerm = searchInput.value.toLowerCase();
                                    const category = parseInt(searchCategory.value);
                                    const rows = document.querySelectorAll(".table tbody tr");

                                    rows.forEach(row => {
                                        const value = row.querySelector(`td:nth-child(${category})`).textContent.trim().toLowerCase();

                                        if (value.includes(searchTerm)) {
                                            row.style.display = "";
                                        } else {
                                            row.style.display = "none";
                                        }
                                    });
                                }

                                function sortTable(column, direction) {
                                    const table = document.querySelector(".table");
                                    const tbody = table.querySelector("tbody");
                                    const rows = Array.from(tbody.querySelectorAll("tr"));

                                    const sortFunction = (a, b) => {
                                        const aValue = a.querySelector(`td:nth-child(${column})`).textContent.trim();
                                        const bValue = b.querySelector(`td:nth-child(${column})`).textContent.trim();
                                        return direction === "asc" ? aValue.localeCompare(bValue) : bValue.localeCompare(aValue);
                                    };

                                    rows.sort(sortFunction);

                                    // Empty the table body and re-append rows in sorted order
                                    while (tbody.firstChild) {
                                        tbody.removeChild(tbody.firstChild);
                                    }

                                    rows.forEach(row => tbody.appendChild(row));
                                }

                                var downloadBtn = document.getElementById("download-btn-users");
                                var table = document.querySelector(".table");

                                downloadBtn.addEventListener("click", function() {
                                    html2canvas(table).then(function(canvas) {
                                        canvas.toBlob(function(blob) {
                                            saveAs(blob, 'table.png');
                                        });
                                    });
                                });
                            });
                        </script>

                        <a href="{{ path('app_user_new') }}">Create new</a>
                    </div>
                </div>
                <div class="card">
                    <div class="card-body">

                        <style>

                            * {
                                box-sizing: border-box;
                            }

                            body {
                                background-color: #f9fafb;
                                font-family: "Open Sans", sans-serif;
                                display: flex;
                                align-items: center;
                                justify-content: center;
                                min-height: 100vh;
                                margin: 0;
                            }

                            .container {
                                background-color: #fff;
                                border-radius: 10px;
                                box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
                                width: 740px;
                            }

                            h1 {
                                text-align: center;
                                margin: 20px 0;
                                color: #565656;
                            }

                            @media all and (max-width: 780px) {
                                .container {
                                    width: auto;
                                }
                            }

                            @media all and (max-width: 400px) {
                                .container {
                                    padding: 0px 20px;
                                }
                            }
                        </style>
                        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
                        <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.3/html2pdf.bundle.min.js"></script>

                        <div class="row">
                            <div class="container" style="width: 48%">
                                <h1>Pie Chart for Users & Admins</h1>
                                <div>
                                    <canvas id="pie-chart"></canvas>
                                    <button id="download-btn">Download PDF</button>
                                </div>
                            </div>
                            <!-- JavaScript to generate the pie chart -->
                            <script>
                                document.addEventListener('DOMContentLoaded', function () {
                                    // Get the table rows
                                    const rows = document.querySelectorAll('.table tbody tr');

                                    // Initialize counts for users and admins
                                    let userCount = 0;
                                    let adminCount = 0;

                                    // Loop through the rows to count users and admins
                                    rows.forEach(row => {
                                        const roleCell = row.querySelector('td:nth-child(3)');
                                        if (roleCell) {
                                            const roles = roleCell.textContent.trim().toLowerCase();
                                            if (roles.includes('admin')) {
                                                adminCount++;
                                            } else {
                                                userCount++;
                                            }
                                        }
                                    });

                                    // Define data and options for the chart
                                    const data = {
                                        labels: ["Admins", "Users"],
                                        datasets: [{
                                            backgroundColor: ["#e63946", "#254BDD"],
                                            data: [adminCount, userCount]
                                        }]
                                    };

                                    const options = {
                                        title: {
                                            display: true,
                                            text: 'Pie Chart for Users & Admins'
                                        },
                                        responsive: true
                                    };

                                    // Create a new pie chart instance
                                    const pieChart = new Chart(document.getElementById('pie-chart'), {
                                        type: 'pie',
                                        data: data,
                                        options: options
                                    });

                                    // Function to download the chart as PNG
                                    // Function to download the chart as PDF
                                    function downloadPDF() {
                                        const element = document.getElementById('pie-chart');
                                        html2pdf()
                                            .from(element)
                                            .save('pie-chart.pdf');
                                    }

                                    // Attach event listener to the download button
                                    document.getElementById('download-btn').addEventListener('click', downloadPDF);
                                });
                            </script>


                            <div class="container" style="width: 48%">
                                <h1>Pie Chart for Ages</h1>
                                <div>
                                    <canvas id="bar-chart"></canvas>
                                </div>
                                <button onclick="downloadPDF()">Download PDF</button>
                            </div>
                            <!-- JavaScript to generate the bar chart -->
                            <script>
                                document.addEventListener('DOMContentLoaded', function () {
                                    // Get all the table rows
                                    const rows = document.querySelectorAll('.table tbody tr');

                                    // Define age groups starting from 18
                                    const ageGroups = [
                                        {min: 18, max: 25, label: '18-25'},
                                        {min: 26, max: 35, label: '26-35'},
                                        {min: 36, max: 45, label: '36-45'},
                                        {min: 46, max: Infinity, label: '45+'}, // New age group for 45 and above
                                        // Add more age groups as needed
                                    ];

                                    // Initialize counts for each age group
                                    const ageGroupCounts = {};

                                    // Initialize counts for each age group
                                    ageGroups.forEach(group => {
                                        ageGroupCounts[group.label] = 0;
                                    });

                                    // Calculate age group for each user
                                    rows.forEach(row => {
                                        const dateOfBirthString = row.querySelector('td:nth-child(7)').textContent.trim(); // Assuming date of birth is in the 7th column
                                        const dateOfBirth = new Date(dateOfBirthString);
                                        const age = calculateAge(dateOfBirth);

                                        // Update counts for age group
                                        ageGroups.forEach(group => {
                                            if (age >= group.min && age <= group.max) {
                                                ageGroupCounts[group.label]++;
                                            }
                                        });
                                    });

                                    // Extract data for chart
                                    const labels = ageGroups.map(group => group.label);
                                    const data = ageGroups.map(group => ageGroupCounts[group.label]);

                                    // Define chart options
                                    const options = {
                                        title: {
                                            display: true,
                                            text: 'Distribution of Users by Age Group',
                                        },
                                        responsive: true,
                                        scales: {
                                            yAxes: [{
                                                ticks: {
                                                    beginAtZero: true,
                                                },
                                            }],
                                        },
                                    };

                                    // Create a new bar chart instance
                                    const barChart = new Chart(document.getElementById('bar-chart'), {
                                        type: 'bar',
                                        data: {
                                            labels: labels,
                                            datasets: [{
                                                label: 'Distribution by age groups',
                                                data: data,
                                                backgroundColor: ['#e63946', '#254BDD', '#ffbe0b', '#1d3557'],
                                            }],
                                        },
                                        options: options,
                                    });
                                });

                                // Function to calculate age based on date of birth
                                function calculateAge(dateOfBirth) {
                                    const today = new Date();
                                    const birthDate = new Date(dateOfBirth);
                                    let age = today.getFullYear() - birthDate.getFullYear();
                                    const month = today.getMonth() - birthDate.getMonth();
                                    if (month < 0 || (month === 0 && today.getDate() < birthDate.getDate())) {
                                        age--;
                                    }
                                    return age;
                                }

                                // Function to download the chart as PDF
                                function downloadPDF() {
                                    const element = document.getElementById('bar-chart');
                                    html2pdf()
                                        .from(element)
                                        .save('bar-chart.pdf');
                                }
                            </script>

                        </div>
                    </div>
                </div>
            </div>
        {% endblock %}
    </div>
</div>
</body>
<script src="{{ asset('back-assets/libs/jquery/dist/jquery.min.js') }}"></script>
<script src="{{ asset('back-assets/libs/bootstrap/dist/js/bootstrap.bundle.min.js') }}"></script>
<script src="{{ asset('back-assets/js/sidebarmenu.js') }}"></script>
<script src="{{ asset('back-assets/js/app.min.js') }}"></script>
<script src="{{ asset('back-assets/libs/simplebar/dist/simplebar.js') }}"></script>
</html>

